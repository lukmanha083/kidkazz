# Wrangler config for running DDD Phase 2 data migration
#
# This worker migrates data from Product Service to Inventory Service:
# - productLocations → inventory
# - variantLocations → inventory (with variantId)
# - productUOMLocations → inventory (with uomId)
# - products.expirationDate → inventoryBatches
#
# Usage:
#   1. Navigate to scripts directory: cd scripts
#   2. Start locally: npx wrangler dev run-ddd-migration.ts --config wrangler-migration.toml --local
#   3. Dry run: curl "http://localhost:8787/migrate?dryRun=true"
#   4. Actual migration: curl "http://localhost:8787/migrate?dryRun=false"
#   5. Validate: curl "http://localhost:8787/validate"

name = "ddd-migration-runner"
main = "run-ddd-migration.ts"
compatibility_date = "2024-11-14"
compatibility_flags = ["nodejs_compat"]

# Product Service Database (source)
[[d1_databases]]
binding = "PRODUCT_DB"
database_name = "product-db"
database_id = "43857977-dffc-4978-bbc9-b64d0f60bc69"
# Inventory Service Database (target)
[[d1_databases]]
binding = "INVENTORY_DB"
database_name = "inventory-db"
database_id = "904fdb02-3a8f-4bb6-9117-5008f6deb3ae"
